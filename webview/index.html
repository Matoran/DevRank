<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <title>Auto complete</title>

    <!--    <link rel="stylesheet" href="../node_modules/popoto/dist/popoto.min.css">-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/popoto/dist/popoto.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
          integrity="sha256-OweaP/Ic6rsV+lysfyS4h+LM6sRwuO3euTYfr6M124g=" crossorigin="anonymous"/>
    <link rel="stylesheet" href="css/auto-complete.css">
    <style>
        #popoto-graph:fullscreen {
            width: 100%;
            height: 100%;
        }

        #popoto-graph:-webkit-full-screen {
            width: 100%;
            height: 100%;
        }

        #popoto-graph:-moz-full-screen {
            width: 100%;
            height: 100%;
        }

        #popoto-graph:-ms-fullscreen {
            width: 100%;
            height: 100%;
        }

        .collapsible-header:focus {
            outline: 0;
        }

        .ppt-taxo__span-icon.Person:before {
            content: "\f2be";
            color: #2aa1d3;
        }

        .ppt-taxo__span-icon.Movie:before {
            content: "\e914";
            color: #8bb71a;
        }

    </style>
</head>
<body style="background-color: #2e3138;">

<div class="navbar-fixed">
    <nav style="background-color: #444951;">
        <div class="nav-wrapper">
            <form style="height:100%; margin-left: 8%; margin-right: 8%; background-color: #525863;"
                  onsubmit="event.preventDefault(); return false;">
                <div class="input-field">
                    <input id="search" type="search" required>
                    <label class="label-icon" for="search">
                        <i class="ppt-icon ppt-icon-search-plus" style="color:#8bb71a;"></i>
                    </label>
                </div>
            </form>
        </div>
    </nav>
</div>

<div class="">
    <ul id="collapsible-components" class="collapsible popout">
        <!-- ======================================================================================================= -->
        <!-- GRAPH QUERY-->
        <!-- ======================================================================================================= -->
        <li id="p-collapsible-popoto" class="active">
            <div class="collapsible-header white-text" style="background-color: #525863; border-bottom: 0;"><i
                    class="ppt-icon ppt-icon-logo" style="color:#8bb71a;"></i> Graph
                Query
            </div>
            <div class="collapsible-body no-padding" style="height: 600px; border-bottom: 0;">
                <div id="popoto-taxonomy" class="ppt-taxo-nav" style="color: white; width: 280px">
                </div>
                <div id="popoto-graph" class="ppt-div-graph">
                </div>
            </div>
        </li>
        <!-- ======================================================================================================= -->
        <!-- QUERY -->
        <!-- ======================================================================================================= -->
        <li id="p-collapsible-query" class="active">
            <div class="collapsible-header white-text" style="background-color: #525863;border-bottom: 0;"><i
                    class="ppt-icon ppt-icon-wrench" style="color:#8bb71a;"></i>Query
            </div>
            <div class="collapsible-body no-padding" style="border-bottom: 0;">
                <div id="popoto-cypher" class="ppt-container-cypher center-align">
                </div>
            </div>
        </li>
        <!-- ======================================================================================================= -->
        <!-- RESULTS -->
        <!-- ======================================================================================================= -->
        <li id="p-collapsible-results" class="active">
            <div class="collapsible-header white-text" style="background-color: #525863;border-bottom: 0;"><i
                    class="ppt-icon ppt-icon-sort-alpha-asc" style="color:#8bb71a;"></i>Results&nbsp;
                <span class="" id="result-total-count">0</span>
            </div>
            <div class="collapsible-body no-padding" style="border-bottom: 0;">
                <div class="row">
                    <div id="popoto-results" class="col s12 cards-container">

                    </div>
                </div>
            </div>
        </li>
    </ul>

</div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.min.js"
        integrity="sha256-k9RyZhvMj2bg0fd8L3IE41t0HpTXnivMoePN/Ksq250=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popoto/dist/popoto.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"
        integrity="sha256-U/cHDMTIHCeMcvehBv1xQ052bPSbJtbuiw4QA9cTKz0=" crossorigin="anonymous"></script>

<script>
    // Demo Neo4j database settings hosted on GrapheneDb
    popoto.rest.CYPHER_URL = 'http://localhost:7474/db/data/transaction/commit'
    // TODO récuperer les credentials d'une autre manière
    popoto.rest.AUTHORIZATION = 'Basic ' + btoa('neo4j:super')

    popoto.graph.WHEEL_ZOOM_ENABLED = false

    popoto.provider.node.Provider = {
        'User': {
            returnAttributes: ['login'],
            constraintAttribute: 'login',
        },
        'Repo': {
            returnAttributes: ['name'],
            constraintAttribute: 'name',
        },
        'Language': {
            returnAttributes: ['name'],
            constraintAttribute: 'name',
        }
    }

    popoto.result.onTotalResultCount(function (count) {
        document.getElementById('result-total-count').innerHTML = '(' + count + ')'
    })

    function initCollapsible () {

        var element = document.querySelector('#collapsible-components')
        var collapsible = new M.Collapsible(element,
            {
                accordion: false,
                onOpenEnd: function (el) {
                    var id = el.id
                    if (id === 'p-collapsible-popoto') {
                        if (popoto.graph.getRootNode() !== undefined) {
                            popoto.graph.getRootNode().px = $('#p-collapsible-popoto').width() / 2
                            popoto.graph.getRootNode().py = 300
                            popoto.updateGraph()
                        }
                    }
                },
                onCloseEnd: function (el) {
                }
            })
    }

    $('#search').keydown((e) => {
        if (13 === (e.keyCode ? e.keyCode : e.which)) {
            console.log('enter pressed.')
            console.log(`text value: ${e.target.value}`)
        }
    })

    initCollapsible()

    popoto.start('User')

</script>
</body>
</html>